# Exploit

## `/alg-none` Endpoint

### Description

-   Challenge này bị lỗi chấp nhận thuật toán `none` trong JWT, cho phép người dùng bypass xác thực.

### Steps to Exploit

1. Truy cập `/alg-none` và đăng nhập với thông tin hợp lệ.
2. Sau khi đăng nhập, sẽ nhận được JWT trong cookie.
3. Chỉnh sửa trường `role` trong `payload` của JWT thành `admin` và xoá phần signature (chừa lại dấu `.`).
4. Gửi JWT đã chỉnh sửa trong cookie và truy cập `/alg-none/dashboard`.

## `/weak-secret` Endpoint

### Description

-   Challenge này bị lỗi sử dụng secret yếu để kí JWT, cho phép người dùng đoán secret hoặc brute-force secret, sau đó sử dụng secret để tạo JWT hợp lệ.

### Steps to Exploit

1. Truy cập `/weak-secret` và đăng nhập với thông tin hợp lệ.
2. Sau khi đăng nhập, sẽ nhận được JWT trong cookie.
3. Brute-force secret:

    - hashcat:

    ```bash
    hashcat -a 0 -m 16500 [JWT] [wordlist]
    ```

    - jwt_tool:

    ```bash
    python3 jwt_tool.py [JWT] -d [wordlist] -C
    ```

4. Chỉnh sửa truờng `role` trong `payload` của JWT thành `admin`.
5. Ký lại JWT với secret đã tìm được:

    - Burp Suite:

        - Encode base64 `secret` vừa tìm được.
        - Sang tab `JWT Editor`, nhấn `New Symmetric Key` > `Generate`, dán `secret` đã encode vào trường `k`.
        - Ký lại JWT với `key` vừa tạo.

    - jwt_tool:

    ```bash
    python3 jwt_tool.py -S hs256 -p [secret] [JWT]
    ```

6. Gửi JWT đã chỉnh sửa trong cookie và truy cập `/weak-secret/dashboard`.

## `/jwk` Endpoint

### Description

-   Challenge cho phép sử dụng JWK để xác thực, nhưng không kiểm tra chữ ký của JWK.

### Steps to Exploit

1. Truy cập `/jwk` và đăng nhập với thông tin hợp lệ.
2. Sau khi đăng nhập, sẽ nhận được JWT trong cookie.
3. Ở tab `JWK Editor` của Burp Suite, nhấn `New RSA Key` > `Generate`
4. Chỉnh sửa trường `role` trong `payload` của JWT thành `admin`.
5. Ở tab `JSON Web Token` ở request, nhấn `Attack` > `Embedded JWK`
6. Gửi JWT đã chỉnh sửa trong cookie và truy cập `/jwk/dashboard`.

## `/jku` Endpoint

### Description

-   Challenge này cho phép sử dụng JKU để xác thực, nhưng không kiểm tra nguồn gốc của JKU.

### Steps to Exploit

1. Truy cập `/jku` và đăng nhập với thông tin hợp lệ.
2. Sau khi đăng nhập, sẽ nhận được JWT trong cookie.
3. Ở tab `JWK Editor` của Burp Suite, nhấn `New RSA Key` > `Generate`
4. Chuột phải vào JWK vừa tạo, nhấn `Copy Public Key as JWK` và lưu vào file `jwks.json`.

    Ví dụ:

    ```json
    // jwks.json
    {
    	"keys": [
    		{
    			"kid": "example-key-id",
    			"kty": "RSA",
    			"e": "AQAB",
    			"n": "nJB2vtCIXwO8DN...lu91RySUTn0wqzBAm-aQ"
    		}
    	]
    }
    ```

5. Chạy HTTP server để phục vụ file `jwks.json`:

    ```bash
    python3 -m http.server 8000
    ```

6. Chỉnh sửa trường `role` trong `payload` của JWT thành `admin`.
7. Chỉnh sửa `kid` thành id của JWK đã tạo.
8. Thêm trường `jku` vào JWT, trỏ đến URL của file `jwks.json` đã tạo.

    Ví dụ:

    ```json
    {
    	"jku": "http://localhost:8000/jwks.json"
    }
    ```

9. Nhấn `Sign` rồi chọn `key` là JWK đã tạo.
10. Gửi JWT đã chỉnh sửa trong cookie và truy cập `/jku/dashboard`.

## `/kid` Endpoint

### Description

-   Challenge sử dụng `kid` để xác định secret, `kid` đọc từ 1 file và lấy dữ liệu từ file đó để làm secret.

### Steps to Exploit

1. Truy cập `/kid` và đăng nhập với thông tin hợp lệ.
2. Sau khi đăng nhập, sẽ nhận được JWT trong cookie.
3. Sử dụng jwt_tool để khai thác:

    - Chỉnh sửa `kid` -> `../../proc/sys/kernel/randomize_va_space`, `role` -> `admin`.

    ```bash
    python3 jwt_tool.py -T [JWT]
    ```

    - Ký lại JWT:

    ```bash
    python3 jwt_tool.py -S hs256 -p '2' [JWT] # 2 là giá trị của file /proc/sys/kernel/randomize_va_space
    ```

4. Gửi JWT đã chỉnh sửa trong cookie và truy cập `/kid/dashboard`.
